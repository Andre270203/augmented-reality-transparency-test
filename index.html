<html>
  <head>
    <meta charset="utf-8">
    <title>AR.js Video Matte Transparency</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script> -->
  </head>

  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      
      <!-- ðŸŽ¥ Carga de videos como assets -->
      <a-assets>
        <video id="videoColor" src="https://raw.githack.com/Andre270203/augmented-reality-transparency-test/main/video%20color.mp4" autoplay loop muted playsinline crossorigin="anonymous"></video>
        <video id="videoAlpha" src="https://raw.githack.com/Andre270203/augmented-reality-transparency-test/main/video%20alpha.mp4" autoplay loop muted playsinline crossorigin="anonymous"></video>
      </a-assets>

      <!-- ðŸ“¦ Shader personalizado para aplicar transparencia -->
      <script id="matte-shader" type="x-shader/x-fragment">
        precision mediump float;
        uniform sampler2D videoColor;
        uniform sampler2D videoAlpha;
        varying vec2 vUV;

        void main() {
          vec4 color = texture2D(videoColor, vUV);
          vec4 alpha = texture2D(videoAlpha, vUV);
          gl_FragColor = vec4(color.rgb, alpha.r);
        }
      </script>

      <!-- ðŸŽ¨ Componente de material personalizado -->
        <script>
            AFRAME.registerShader('video-matte-shader', {
                schema: {
                    videoColor: { type: 'map', is: 'uniform' },
                    videoAlpha: { type: 'map', is: 'uniform' }
                },
                fragmentShader: document.getElementById('matte-shader').textContent,
                vertexShader: `
                    varying vec2 vUV;
                    void main() {
                        vUV = uv;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `
            });
  </script>

      <!-- ðŸ§­ MARCADOR AR + PLANO que reproduce el video con transparencia -->
      <a-nft
      type="nft"
      url="https://raw.githack.com/Andre270203/augmented-reality-transparency-test/main/marker/leon"
      smooth="true"
      smoothCount="10"
      smoothTolerance=".01"
      smoothThreshold="5"
    >
        <a-entity 
          geometry="primitive: plane; height: 1; width: 1"
          material="shader: video-matte-shader; 
                    videoColor: #videoColor; 
                    videoAlpha: #videoAlpha"
          position="50 150 -100">
        </a-entity>
      </a-nft>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
